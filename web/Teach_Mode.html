<!DOCTYPE html>
<html lang="en">
  <head>
    <title>APC UI</title>

    <!-- Bootstrap -->
    <link href="bootstrap/css/bootstrap.min.css" rel="stylesheet">
		
    <script src="js/jquery-1.11.3.js"></script>
    <script src="bootstrap/js/bootstrap.min.js"></script>
		
		<style>
			nav {
				background-color: #b0c4de;
				height: 55px;
				margin-top: 20px;
				margin-left: 30px;
				margin-bottom: 10px;
				margin-right: 30px;
			}
			
			.add{
				margin-top: 10px;
				margin-left: 10px;
				margin-bottom: 10px;
				margin-right: 10px;
				top : 100%;
				font-size: 20px;
			}
			
			.options{
				font-size: 22px;
				height: 80%;
			}
			
			#block input{
				font-size: 22px;
				height: 80%;
				size:5;
			}
			
			#base{
				border-style: solid;
				border-width: medium;
				margin-left: 30px;
				margin-right: 30px;
				height: 200px;
				overflow:auto;
			}
			
			.default{
				display:block;
			}
			
			.edit{
				display:none;
			}
			
			table {
				width : 99%;
				margin : auto;
				
			}
			
			thead {
				border-collapse: collapse;
				border-bottom: solid #ff0000;
				font-size : 20px;
			}
			
			.edit_mod{
			
			}
			
			.img_show{
				height: 32px;
				width: 32px;
				display: none;
			}
			
		</style>
		
</head>
<body>
	<nav>
		<button type="button" id="addbtn" class="add" ><span class="glyphicon glyphicon-plus"></span></button>
		<select class="options" id="cmd_select">
			<option value="Choose">Choose</option>
			<option value="Joint">Joint</option>
			<option value="PTP">PTP</option>
			<option value="Line">Line</option>
      <option value="Vaccum">Vaccum</option>
		</select>
		
		<div id="block" style= "display:none;">
			<input value="0" id="block_1" style="width: 10%" type="number"/>
			<input value="0" id="block_2" style="width: 10%" type="number"/>
			<input value="0" id="block_3" style="width: 10%" type="number"/>
			<input value="0" id="block_4" style="width: 10%" type="number"/>
			<input value="0" id="block_5" style="width: 10%" type="number"/>
			<input value="0" id="block_6" style="width: 10%" type="number"/>
		</div>
		
		<div id="vaccum_block" style= "display:none;">
			<select class="options" id="vaccum_select"/>
				<option value="On">On</option>
				<option value="Off">Off</option>
			</select>
		</div>
	</nav>
	<div style="overflow:auto; margin:auto; height:300px; width:98%; border-style: solid;
				border-width: medium;">
		<table>
			<thead>
				<tr>
				<th style="width:20%">Command</th>
				<th style="width:60%">SubCommand</th>
				<th style="width:15%">Edit</th>
				<th style="width:5%">Delete</th>
				</tr>
			</thead>
			<tbody id="teach_table">
			</tbody>
		</table>
	</div>
	<script>
		var CmdType = {
			Joint: "Joint",
			PTP: "PTP",
			Line: "Line",
			Vaccum: "Vaccum"
		};
		
		var addbtn = document.getElementById("addbtn");
		var edit_img = '<img id="edit_btn" src="img/edit.png" onclick="edit_Cmd(this)"/>';
		var cmd_id = 0;
				
		function hide_all(){
			$("#block").hide();
			$("#vaccum_block").hide();
		}
		
		function get_cmd_id(){
			cmd_id++;
			return "cmd_"+cmd_id;
		}
		
		$("#cmd_select").change(function() {
			console.log($(this).val());
			cmd = $(this).val();
			if(cmd==CmdType.Joint || cmd==CmdType.PTP || cmd==CmdType.Line){
				hide_all();
				$("#block").show();
				$("#block").css("display","inline");
			}else if(cmd==CmdType.Vaccum){
				hide_all();
				$("#vaccum_block").show();
				$("#vaccum_block").css("display","inline");
			}else{
				hide_all();
			}
		});
		
		function get_block_tr(option){
			var sub_cmd = '';
			var cmd_id = get_cmd_id();
			for(var i=1;i<=6;i++){
				var t_id = '#block_'+i;
				sub_cmd += '<input style="width: 15%; border-style:none;" type="number" value="'+$(t_id).val()+'"readonly>';
			}
			
			var edit_img_new = $(edit_img).attr('target_cmd_id', cmd_id).prop('outerHTML');
			
			var true_img = '<img id="true_btn" src="img/true.png" class="img_show" onclick="save_Cmd(this)"/>';
			true_img = $(true_img).attr('target_cmd_id', cmd_id).prop('outerHTML');
		
			var false_img = '<img id="false_btn" src="img/false.png" class="img_show" onclick="break_Cmd(this)"/>';
			false_img = $(false_img).attr('target_cmd_id', cmd_id).prop('outerHTML');
			
			var delete_img = '<img id="delete_opt" src="img/delete.png" style="width:20%; height:auto;" onclick="delete_Cmd(this)"/>';			
			delete_img = $(delete_img).attr('target_cmd_id', cmd_id).prop('outerHTML');
			
			var add_tr = 
			'<tr id='+cmd_id+'>' +
				'<td id="cmd_mod">'+CmdType[option]+'</td>'+
				'<td class="SubCmd">'+sub_cmd+'</td>'+
				'<td>'+edit_img_new+
				true_img +
				false_img +
				'</td>'+
				'<td>'+delete_img+'</td>'+
			'</tr>';
			
			return add_tr;
		}
		
		function get_vaccum_tr(){
			
			var cmd_id = get_cmd_id();
			var sub_cmd = $('#vaccum_select').val();
			
			if(sub_cmd == "On"){
				var sub_cmd_edit =
				'<select class="options" id="vaccum_select" disabled="disabled" style="border-style: none">' +
					'<option value="On" selected>On</option>'+
					'<option value="Off">Off</option>' +
				'</select>';
			}else if(sub_cmd == "Off"){
				var sub_cmd_edit =
				'<select class="options" id="vaccum_select" disabled="disabled" style="border-style: none">' +
					'<option value="On">On</option>'+
					'<option value="Off" selected>Off</option>' +
				'</select>';
			}
			
			var edit_img_new = $(edit_img).attr('target_cmd_id', cmd_id).prop('outerHTML');
			
			var true_img = '<img id="true_btn" src="img/true.png" class="img_show" onclick="save_Cmd(this)"/>';
			true_img = $(true_img).attr('target_cmd_id', cmd_id).prop('outerHTML');
			
			var false_img = '<img id="false_btn" src="img/false.png" class="img_show" onclick="break_Cmd(this)"/>';
			false_img = $(false_img).attr('target_cmd_id', cmd_id).prop('outerHTML');
			
			var delete_img = '<img id="delete_opt" src="img/delete.png" style="width:20%; height:auto;" onclick="delete_Cmd(this)"/>';
			delete_img = $(delete_img).attr('target_cmd_id', cmd_id).prop('outerHTML');
			
			var add_tr = 
			'<tr id="'+cmd_id+'">' +
				'<td id="cmd_mod">'+CmdType.Vaccum+'</td>'+
				'<td id="edit">'+sub_cmd_edit+'</td>'+
				'<td>'+edit_img_new+
				true_img +
				false_img +
				'</td>'+
				'<td>'+delete_img+'</td>'+
			'</tr>';
			
			return add_tr;
		}
		
		addbtn.onclick = function(){
			console.log("in addBtn");
			var cmd = $("#cmd_select").val();
			var tr_html = '';
			
			if(cmd==CmdType.Joint || cmd==CmdType.PTP || cmd==CmdType.Line){
				tr_html = get_block_tr(cmd);
			}else if(cmd==CmdType.Vaccum){
				tr_html = get_vaccum_tr();
			}
		
			console.log("tr_html="+tr_html);
			$('#teach_table').append(tr_html);
			
		}
		
		var cmd_edit = new Array;
		var vac_cmd;
		
		function edit_Cmd(edit){
			var m_cmd_id = $(edit).attr('target_cmd_id');
			console.log("m_cmd_id="+m_cmd_id);
			
			$('#'+m_cmd_id).find('#edit_btn').hide();
			$('#'+m_cmd_id).find('#true_btn').show();
			$('#'+m_cmd_id).find('#false_btn').show();
			
			var mod = $('#'+m_cmd_id).children("td:first").html();
			var i = 0;
			if(mod==CmdType.Joint || mod==CmdType.PTP || mod==CmdType.Line){
				$('#'+m_cmd_id).children("td.SubCmd").children("input").each(function(){
					//console.log($(this).val());
					$(this).removeAttr("readonly");
					$(this).css("border-style","inset");
					cmd_edit[i++] = $(this).val();
				});
			}else if(mod==CmdType.Vaccum){
				$('#'+m_cmd_id).find('#vaccum_select').removeAttr("disabled");
				$('#'+m_cmd_id).find('#vaccum_select').css("border-style","inset");
				vac_cmd = $('#'+m_cmd_id).find('#vaccum_select').val();
			}else{
			
			}	
		}
		
		function save_Cmd(edit){
			var m_cmd_id = $(edit).attr('target_cmd_id');
			console.log("m_cmd_id="+m_cmd_id);
			
			$('#'+m_cmd_id).find('#edit_btn').show();
			$('#'+m_cmd_id).find('#true_btn').hide();
			$('#'+m_cmd_id).find('#false_btn').hide();
			
			var mod = $('#'+m_cmd_id).children("td:first").html();
			
			if(mod==CmdType.Joint || mod==CmdType.PTP || mod==CmdType.Line){
				$('#'+m_cmd_id).children("td.SubCmd").children("input").each(function(){
					$(this).attr("readonly");
					$(this).css("border-style","none");
				});
			}else if(mod==CmdType.Vaccum){
				$('#'+m_cmd_id).find('#vaccum_select').attr("disabled","disabled");
				$('#'+m_cmd_id).find('#vaccum_select').css("border-style","none");
			}else{
			
			}
		}
		
		function break_Cmd(edit){
			var m_cmd_id = $(edit).attr('target_cmd_id');
			console.log("m_cmd_id="+m_cmd_id);
			
			$('#'+m_cmd_id).find('#edit_btn').show();
			$('#'+m_cmd_id).find('#true_btn').hide();
			$('#'+m_cmd_id).find('#false_btn').hide();
			
			var mod = $('#'+m_cmd_id).children("td:first").html();
			var i = 0;
			if(mod==CmdType.Joint || mod==CmdType.PTP || mod==CmdType.Line){
				$('#'+m_cmd_id).children("td.SubCmd").children("input").each(function(){
					$(this).val(cmd_edit[i++]);
					$(this).attr("readonly");
					$(this).css("border-style","none");
				});
			}else if(mod==CmdType.Vaccum){
				$('#'+m_cmd_id).find('#vaccum_select').val(vac_cmd);
				$('#'+m_cmd_id).find('#vaccum_select').attr("disabled","disabled");
				$('#'+m_cmd_id).find('#vaccum_select').css("border-style","none");
			}else{
			
			}
		}
		
		function delete_Cmd(edit){
			var m_cmd_id = $(edit).attr('target_cmd_id');
			console.log("m_cmd_id="+m_cmd_id);
			
			$('#'+m_cmd_id).remove();
		}
		
	</script>

  </body>
</html>